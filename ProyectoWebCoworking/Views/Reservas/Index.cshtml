@model IEnumerable<ProyectoWebCoworking.Models.Reserva>
@{
	ViewData["Title"] = "Gestionar Reservas";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5 mb-5">

	<div class="d-flex justify-content-between align-items-center mb-4">
		<div>
			<h1 class="display-6 fw-bold text-danger"><i class="bi bi-calendar-check-fill me-2"></i>Reservas</h1>
			<p class="text-muted">Supervisión y cancelación de todas las reservas del sistema.</p>
		</div>		
	</div>	
	
	<div class="card shadow-lg border-0 overflow-hidden">
		<div class="table-responsive">
			<table class="table table-hover align-middle mb-0">
				<thead class="bg-light text-uppercase small fw-bold text-muted">
					<tr>
						<th class="py-3 ps-4">Usuario</th>
						<th>Recurso</th>
						<th>Inicio</th>						
						<th>Fin</th>
						<th>Estado</th>
						<th class="text-end pe-4">Acciones</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model)
					{
						<tr>
							<td class="ps-4 fw-bold text-dark">
								<i class="bi bi-person-circle me-2 text-secondary"></i>@Html.DisplayFor(modelItem => item.Usuario.Nombre)									
							</td>
							<td>
								<span class="badge bg-danger bg-opacity-10 text-danger border border-danger px-2">
									@Html.DisplayFor(modelItem => item.Recurso.Nombre)
								</span>								
							</td>
							<td class="text-muted small">@item.FechaHoraInicio.ToString("g")</td>
							<td class="text-muted small">@item.FechaHoraFin.ToString("g")</td>
							<td>
								@if (item.Estado == "Confirmada")
								{
									<span class="badge bg-success text-white rounded-pill">Activa</span>
								}
								else
								{
									<span class="badge bg-secondary rounded-pill">@item.Estado</span>
								}
							</td>

							<td class="text-end pe-4">
								<button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalConfirmarBorrado" data-id-reserva="@item.Id" data-nombre-reserva="Reserva de @item.Usuario.Nombre">
									<i class="bi bi-trash3-fill"></i>
								</button>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
	
</div>
<div class="modal fade" id="modalConfirmarBorrado" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content border-0 shadow">
			<div class="modal-header bg-danger text-white">
				<h5 class="modal-title"><i class="bi bi-exclamation-triangle-fill me-2"></i>Cancelar Reserva</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body p-4 text-center">
				<div class="mb-3">
					<i class="bi bi-trash3 text-danger display-1"></i>
				</div>
				<p class="lead mb-1">¿Seguro de que quieres cancelar esta reserva?</p>
				<p class="fw-bold mb-3" id="nombreReservaModal">...</p>
				<p class="text-muted small">Se liberará el recurso inmediatamente.</p>
			</div>
			<div class="modal-footer justify-content-center">
				<form asp-action="Delete" method="post" class="w-100 px-4 d-flex gap-2">
					<input type="hidden" name="id" id="idReservaHidden" />
					<button type="button" class="btn btn-light border flex-grow-1" data-bs-dismiss="modal">Volver</button>
					<button type="submit" class="btn btn-danger flex-grow-1">Confirmar Cancelación</button>
				</form>
			</div>
		</div>
	</div>
</div>
@section Scripts {
	<script>
		$(document).ready(function() {
			$('#modalConfirmarBorrado').on('show.bs.modal', function (event) {
				var button = $(event.relatedTarget);
				var id = button.data('id-reserva');
				var nombre = button.data('nombre-reserva');
				var modal = $(this);
				modal.find('.modal-body #nombreReservaModal').text(nombre);
				modal.find('.modal-footer #idReservaHidden').val(id);
			});
		});
	</script>
}